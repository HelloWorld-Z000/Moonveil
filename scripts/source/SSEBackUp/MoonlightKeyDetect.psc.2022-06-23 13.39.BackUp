scriptName MoonlightKeyDetect extends ActiveMagicEffect

spell property SpellRelease auto
spell property SpellReleaseDirection auto
Actor MoonlightActor

Int MKDCount = 0
Float MKDtime = 0.00000

event OnEffectStart(actor akTarget, actor akCaster)
    MoonlightActor = akTarget
    self.RegisterForControl("Left Attack/Block")
    self.RegisterForControl("Right Attack/Block")

endevent

event OnEffectFinish(actor akTarget, actor akCaster)
    MoonlightActor = akTarget
    self.UnRegisterForControl("Left Attack/Block")
    self.UnRegisterForControl("Right Attack/Block")

endevent

event OnUpdate()

    MKDCount += 1
    if MKDCount == 1
            self.RegisterForSingleUpdate(MKDtime)
        elseIf MKDCount == 2
            self.RegisterForSingleUpdate(MKDtime)
        endIf
endevent

event OnControlDown(String Control)

    if Control == "Left Attack/Block" || Control == "Right Attack/Block"
        SpellRelease.Cast(MoonlightActor)
        BMCount = 0
        BMCtime = 1.66000 / BowMagicActor.GetEquippedWeapon(false).GetSpeed() * BMCQSP
        self.RegisterForSingleUpdate(0 as Float)

endevent    
    
event OnControlUp(String Control, Float HoldTime)

    if Control == "Left Attack/Block" || Control == "Right Attack/Block"
        SpellRelease.Cast(MoonlightActor)
    endIf
    if Control == "Right Attack/Block"
        SpellRelease.Cast(MoonlightActor)
    endIf
endevent
